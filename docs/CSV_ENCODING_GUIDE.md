# CSV文件中文编码指南

## 问题描述

在使用批量导入功能时，如果CSV文件包含中文内容，可能会出现乱码问题。这主要是由于文件编码格式不正确导致的。

## 解决方案

### ✅ 已修复的技术问题

系统已经完成以下修复：

1. **文件读取编码**：`FileReader.readAsText(file, 'UTF-8')` 显式指定UTF-8编码
2. **BOM头处理**：自动检测和移除UTF-8 BOM标记
3. **智能CSV解析**：支持带中文逗号的引用字段
4. **换行符规范化**：兼容Windows、macOS、Linux的不同换行符

### 📝 用户操作最佳实践

#### 1. Excel保存CSV文件
```
1. 在Excel中打开或创建数据表
2. 点击 "文件" → "另存为"
3. 在"保存类型"中选择 "CSV UTF-8(逗号分隔)(*.csv)"
4. 点击保存
```

#### 2. 记事本保存CSV文件
```
1. 在记事本中编辑CSV内容
2. 点击 "文件" → "另存为"
3. 在"编码"下拉菜单中选择 "UTF-8"
4. 文件扩展名设为 .csv
5. 点击保存
```

#### 3. VSCode/其他编辑器
```
1. 创建新文件，输入CSV内容
2. 确保编辑器状态栏显示 "UTF-8" 编码
3. 如果显示其他编码，点击切换为UTF-8
4. 保存为 .csv 文件
```

## 正确的CSV格式示例

### 基本格式
```csv
name,minPlayers,maxPlayers,platform,type,description
王者荣耀,5,5,移动端,MOBA,经典5V5竞技游戏
英雄联盟,5,5,PC,MOBA,全球最受欢迎的MOBA游戏
剧本杀,4,8,线下,推理,沉浸式角色扮演推理游戏
```

### 包含逗号的字段（使用引号）
```csv
name,minPlayers,maxPlayers,platform,type,description
"游戏名称,包含逗号",2,4,PC,策略,"游戏描述,也包含逗号"
"Among Us",4,10,PC,推理,"太空狼人杀游戏,经典推理"
```

### 包含换行的字段
```csv
name,minPlayers,maxPlayers,platform,type,description
"多行描述游戏",2,4,PC,策略,"这是第一行描述
这是第二行描述"
```

## 常见问题排查

### ❌ 问题：中文显示为乱码
**原因**：文件编码不是UTF-8  
**解决**：使用上述方法重新保存为UTF-8编码

### ❌ 问题：包含逗号的字段被错误分割
**原因**：没有使用引号包围包含逗号的字段  
**解决**：给包含逗号的字段加上双引号

### ❌ 问题：某些行被跳过
**原因**：行的字段数量与标题行不匹配  
**解决**：检查每行的逗号数量，确保与标题行一致

### ❌ 问题：Excel打开CSV文件乱码
**原因**：Excel默认使用GB2312编码打开CSV  
**解决**：
1. 在Excel中选择"数据" → "从文本"
2. 选择CSV文件
3. 在导入向导中指定"UTF-8"编码

## 测试方法

1. **创建测试文件**：使用上述示例创建一个包含中文的CSV文件
2. **验证编码**：确保文件保存为UTF-8格式
3. **导入测试**：在系统中使用批量导入功能
4. **检查结果**：确认中文内容正确显示

## 支持的字符范围

系统完全支持以下字符：
- ✅ 简体中文：汉字、标点符号
- ✅ 繁体中文：汉字、标点符号
- ✅ 日文：假名、汉字
- ✅ 韩文：谚文字符
- ✅ 特殊符号：emoji、数学符号等
- ✅ 混合内容：中英文混合

## 技术说明

系统采用以下技术确保编码正确：

```javascript
// 文件读取时指定UTF-8编码
reader.readAsText(file, 'UTF-8');

// 处理BOM头
if (content.charCodeAt(0) === 0xFEFF) {
  content = content.slice(1);
}

// 智能CSV解析，支持引号字段
const parseCSVLine = (line) => {
  // 处理引号、逗号、换行符
};
```

## 联系支持

如果仍然遇到编码问题，请：
1. 确认使用UTF-8编码保存文件
2. 检查CSV格式是否正确
3. 查看浏览器控制台的错误信息
4. 提供问题文件的前几行内容进行诊断 