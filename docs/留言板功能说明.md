# 留言板功能说明

## 功能概述

留言板是一个完整的消息交流系统，支持发布留言、@用户功能和通知系统。用户可以在此进行日常交流、发布公告、相互@提醒等。

## 核心功能

### 1. 留言发布功能
- 支持文本留言发布
- 最大长度限制：500字符
- 支持@用户功能
- 快捷键：Ctrl+Enter 快速发送
- 实时字符计数提示

### 2. @用户功能
- 在留言中输入 `@用户名` 可以提及其他用户
- 支持用户名自动补全
- 被@的用户会收到通知提醒
- @用户的文本会高亮显示

### 3. 通知系统
- 被@用户登录后会看到通知角标
- 通知面板显示详细的@消息
- 支持标记单个通知为已读
- 支持一键标记所有通知为已读
- 通知角标实时更新未读数量

### 4. 留言管理
- 用户只能删除自己发布的留言
- 删除留言时会同时删除相关通知
- 支持留言列表分页加载
- 按时间倒序显示留言

## 使用方法

### 发布留言
1. 打开留言板页面（导航栏中的"留言板"）
2. 在留言编辑器中输入内容
3. 可以使用 `@用户名` 来提及其他用户
4. 点击"发布留言"按钮或按 Ctrl+Enter 发送

### @用户操作
1. 在留言中输入 `@`
2. 继续输入用户名，系统会显示匹配的用户列表
3. 选择要@的用户
4. 发布留言后，被@用户会收到通知

### 查看通知
1. 登录后查看导航栏右上角的通知图标
2. 如有未读通知，会显示红色角标
3. 点击通知按钮可打开通知面板
4. 在通知面板中查看详细信息并标记已读

### 删除留言
1. 在留言列表中找到自己发布的留言
2. 点击留言右侧的删除按钮
3. 确认删除操作

## 技术特点

### 前端技术
- React + TypeScript 开发
- Antd UI 组件库
- Zustand 状态管理
- 响应式设计，支持移动端

### 后端技术
- LeanCloud 云服务
- 两个数据表：Message（留言）、MessageNotification（通知）
- 自动化通知创建和管理

### 实时功能
- 通知数量每30秒自动更新
- 支持实时查看新留言
- 自动刷新通知状态

## 数据结构

### 留言数据（Message）
```typescript
interface Message {
  objectId: string;          // 留言ID
  content: string;           // 留言内容
  authorId: string;          // 作者ID
  authorName: string;        // 作者昵称
  mentionedUsers: string[];  // 被@的用户ID列表
  createdAt: Date;           // 创建时间
  updatedAt: Date;           // 更新时间
}
```

### 通知数据（MessageNotification）
```typescript
interface MessageNotification {
  objectId: string;          // 通知ID
  messageId: string;         // 留言ID
  recipientId: string;       // 接收者ID
  senderId: string;          // 发送者ID
  senderName: string;        // 发送者昵称
  messageContent: string;    // 留言内容摘要
  isRead: boolean;           // 是否已读
  createdAt: Date;           // 创建时间
  updatedAt: Date;           // 更新时间
}
```

## API 接口

### 留言相关接口
- `createMessage(params)` - 创建留言
- `getMessageList(params)` - 获取留言列表
- `deleteMessage(messageId)` - 删除留言

### 通知相关接口
- `getUserNotifications()` - 获取用户通知
- `markNotificationAsRead(notificationId)` - 标记通知已读
- `markAllNotificationsAsRead()` - 标记所有通知已读
- `getUnreadNotificationCount()` - 获取未读通知数量

### 用户相关接口
- `getAllUsers()` - 获取用户列表（用于@功能）
- `parseMentionedUsers(content, users)` - 解析@用户

## 权限控制

### 留言权限
- 所有登录用户都可以发布留言
- 用户只能删除自己的留言
- 用户可以查看所有留言

### 通知权限
- 用户只能查看自己的通知
- 用户只能管理自己的通知状态

## 性能优化

### 前端优化
- 分页加载留言列表，避免一次性加载大量数据
- 通知数量定时更新，减少API调用
- 缓存用户列表，提升@功能响应速度

### 后端优化
- 使用LeanCloud的查询优化
- 合理设计数据表结构和索引
- 批量操作减少API请求次数

## 注意事项

1. **字符限制**：留言内容最大500字符
2. **@用户限制**：需要输入完整的用户名
3. **通知延迟**：通知更新最多有30秒延迟
4. **删除限制**：只能删除自己的留言，删除后不可恢复
5. **兼容性**：建议使用现代浏览器以获得最佳体验

## 未来扩展

可以考虑的功能扩展：
1. 留言回复功能
2. 表情符号支持
3. 文件附件上传
4. 留言搜索功能
5. 留言标签分类
6. 私信功能
7. 群组留言板

## 问题排查

### 常见问题
1. **无法发布留言**：检查是否登录，内容是否超过限制
2. **@用户不生效**：确认用户名拼写正确
3. **通知不显示**：等待30秒后刷新页面
4. **无法删除留言**：确认是否为留言作者

### 调试工具
在开发环境中，可以使用浏览器控制台的调试工具：
- 查看应用状态
- 检查API调用
- 重置初始化状态 