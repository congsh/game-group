<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­˜å‚¨åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #40a9ff;
        }
        .output {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #1890ff;
        }
        .success { border-left-color: #52c41a; }
        .error { border-left-color: #ff4d4f; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ æ¸¸æˆç»„é˜Ÿå¹³å° - å­˜å‚¨åŠŸèƒ½æµ‹è¯•</h1>
        
        <h2>æµ‹è¯•localStorageåŠŸèƒ½</h2>
        <div>
            <button onclick="testBasicStorage()">ğŸ§ª åŸºç¡€å­˜å‚¨æµ‹è¯•</button>
            <button onclick="testEncryption()">ğŸ” åŠ å¯†å­˜å‚¨æµ‹è¯•</button>
            <button onclick="checkCurrentStorage()">ğŸ“‹ æ£€æŸ¥å½“å‰å­˜å‚¨</button>
            <button onclick="clearStorage()">ğŸ—‘ï¸ æ¸…ç©ºå­˜å‚¨</button>
        </div>
        
        <div id="output" class="output">
            æµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
        </div>
        
        <h2>è‡ªåŠ¨ç™»å½•æµ‹è¯•æ­¥éª¤</h2>
        <ol>
            <li>å…ˆæ¸…ç©ºå½“å‰å­˜å‚¨</li>
            <li>åœ¨åº”ç”¨ä¸­ç™»å½•å¹¶é€‰æ‹©"è®°ä½æˆ‘"</li>
            <li>åˆ·æ–°é¡µé¢æ£€æŸ¥æ˜¯å¦è‡ªåŠ¨ç™»å½•</li>
            <li>è¿”å›æ­¤é¡µé¢æŸ¥çœ‹å­˜å‚¨å†…å®¹</li>
        </ol>
        
        <h2>æµè§ˆå™¨æ”¯æŒæ£€æŸ¥</h2>
        <div>
            <button onclick="checkBrowserSupport()">ğŸŒ æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ</button>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : '';
            output.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            document.getElementById('output').innerHTML = '';
        }

        function testBasicStorage() {
            clearOutput();
            log('ğŸ§ª å¼€å§‹åŸºç¡€å­˜å‚¨æµ‹è¯•...');
            
            try {
                // æµ‹è¯•localStorage
                const testKey = 'test_basic_storage';
                const testValue = 'Hello World - ' + Date.now();
                
                localStorage.setItem(testKey, testValue);
                const retrieved = localStorage.getItem(testKey);
                
                if (retrieved === testValue) {
                    log('âœ… localStorage åŸºç¡€è¯»å†™åŠŸèƒ½æ­£å¸¸', 'success');
                } else {
                    log('âŒ localStorage è¯»å†™å¼‚å¸¸', 'error');
                }
                
                // æ¸…ç†æµ‹è¯•æ•°æ®
                localStorage.removeItem(testKey);
                log('ğŸ§¹ æµ‹è¯•æ•°æ®å·²æ¸…ç†');
                
            } catch (error) {
                log('âŒ localStorage æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }

        function testEncryption() {
            clearOutput();
            log('ğŸ” å¼€å§‹åŠ å¯†å­˜å‚¨æµ‹è¯•...');
            
            // æ¨¡æ‹ŸåŠ å¯†å­˜å‚¨ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
            try {
                const testData = {
                    user: {
                        objectId: 'test123',
                        username: 'æµ‹è¯•ç”¨æˆ·',
                        favoriteGames: []
                    },
                    timestamp: Date.now(),
                    rememberMe: true
                };
                
                // ç®€å•çš„base64ç¼–ç æ¨¡æ‹ŸåŠ å¯†
                const encoded = btoa(JSON.stringify(testData));
                localStorage.setItem('test_encryption', encoded);
                
                // å°è¯•è§£ç 
                const retrieved = localStorage.getItem('test_encryption');
                const decoded = JSON.parse(atob(retrieved));
                
                if (decoded.user.username === testData.user.username) {
                    log('âœ… åŠ å¯†å­˜å‚¨æ¨¡æ‹Ÿæµ‹è¯•æˆåŠŸ', 'success');
                    log('ğŸ“„ å­˜å‚¨çš„æ•°æ®: ' + JSON.stringify(decoded, null, 2));
                } else {
                    log('âŒ åŠ å¯†å­˜å‚¨æµ‹è¯•å¤±è´¥', 'error');
                }
                
                // æ¸…ç†
                localStorage.removeItem('test_encryption');
                
            } catch (error) {
                log('âŒ åŠ å¯†å­˜å‚¨æµ‹è¯•å¼‚å¸¸: ' + error.message, 'error');
            }
        }

        function checkCurrentStorage() {
            clearOutput();
            log('ğŸ“‹ æ£€æŸ¥å½“å‰å­˜å‚¨çŠ¶æ€...');
            
            // æ£€æŸ¥æ¸¸æˆç»„é˜Ÿå¹³å°çš„å­˜å‚¨
            const authKey = 'game_group_auth';
            const localAuth = localStorage.getItem(authKey);
            const sessionAuth = sessionStorage.getItem(authKey);
            
            log('ğŸ” localStorage ä¸­çš„è®¤è¯æ•°æ®: ' + (localAuth ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'));
            if (localAuth) {
                log('ğŸ“¦ localStorage æ•°æ®é•¿åº¦: ' + localAuth.length + ' å­—ç¬¦');
                log('ğŸ“¦ localStorage åŸå§‹æ•°æ®: ' + localAuth.substring(0, 100) + '...');
            }
            
            log('ğŸ” sessionStorage ä¸­çš„è®¤è¯æ•°æ®: ' + (sessionAuth ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'));
            if (sessionAuth) {
                log('ğŸ“¦ sessionStorage æ•°æ®é•¿åº¦: ' + sessionAuth.length + ' å­—ç¬¦');
            }
            
            // åˆ—å‡ºæ‰€æœ‰å­˜å‚¨çš„é”®
            log('ğŸ“ localStorage ä¸­çš„æ‰€æœ‰é”®:');
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                log('  - ' + key);
            }
        }

        function clearStorage() {
            clearOutput();
            log('ğŸ—‘ï¸ æ¸…ç©ºå­˜å‚¨...');
            
            const authKey = 'game_group_auth';
            localStorage.removeItem(authKey);
            sessionStorage.removeItem(authKey);
            
            log('âœ… è®¤è¯ç›¸å…³å­˜å‚¨å·²æ¸…ç©º', 'success');
            log('ğŸ’¡ ç°åœ¨å¯ä»¥æµ‹è¯•é‡æ–°ç™»å½•åŠŸèƒ½äº†');
        }

        function checkBrowserSupport() {
            clearOutput();
            log('ğŸŒ æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ...');
            
            // æ£€æŸ¥localStorageæ”¯æŒ
            if (typeof(Storage) !== "undefined") {
                log('âœ… localStorage æ”¯æŒæ­£å¸¸', 'success');
            } else {
                log('âŒ æµè§ˆå™¨ä¸æ”¯æŒlocalStorage', 'error');
            }
            
            // æ£€æŸ¥sessionStorageæ”¯æŒ
            if (typeof(sessionStorage) !== "undefined") {
                log('âœ… sessionStorage æ”¯æŒæ­£å¸¸', 'success');
            } else {
                log('âŒ æµè§ˆå™¨ä¸æ”¯æŒsessionStorage', 'error');
            }
            
            // æ£€æŸ¥cryptoæ”¯æŒï¼ˆç”¨äºåŠ å¯†ï¼‰
            if (typeof(btoa) !== "undefined" && typeof(atob) !== "undefined") {
                log('âœ… Base64 ç¼–ç æ”¯æŒæ­£å¸¸', 'success');
            } else {
                log('âŒ Base64 ç¼–ç ä¸æ”¯æŒ', 'error');
            }
            
            // æ£€æŸ¥JSONæ”¯æŒ
            if (typeof(JSON) !== "undefined") {
                log('âœ… JSON æ”¯æŒæ­£å¸¸', 'success');
            } else {
                log('âŒ JSON ä¸æ”¯æŒ', 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            log('ğŸ‰ å­˜å‚¨åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
            log('ğŸ’¡ ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•');
        };
    </script>
</body>
</html> 